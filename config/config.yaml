alerts:
  channels:
    database: true
    email: false
    webhook: false
  enabled: true
  thresholds:
    api_error: 5
    balance_low: 50
    daily_loss: 0.05
    trade_failure: 3
balance_manager:
  check_interval_seconds: 30
  max_balance_usage: 0.9
  min_balance_threshold: 10
database:
  host: postgres
  max_overflow: 20
  name: trading_bot_futures
  options: -c search_path=trading,public
  password: mypassword
  pool_size: 10
  port: 5432
  user: carloslarramba
database_manager:
  backup_interval_hours: 24
  connection_timeout: 30
  max_retries: 3
  query_timeout: 60
exchange_manager:
  max_retries: 3
  rate_limit_delay: 0.1
  request_timeout: 30
  retry_delay: 1
exchanges:
  binance:
    base_currency: USDC
    market_type: spot
    max_pairs: 10
    min_volatility: 0.02
    min_volume_24h: 1000000
    sandbox: false
    websocket_url: "wss://stream.binance.com:9443/ws/!ticker@arr"
    websocket_private: "wss://stream.binance.com:9443/ws"
  bybit:
    base_currency: USDC
    market_type: spot
    max_pairs: 5
    min_volatility: 0.015
    min_volume_24h: 500000
    sandbox: false
    websocket_url: "wss://stream.bybit.com/v5/public/spot"
    websocket_private: "wss://stream.bybit.com/v5/private"
  cryptocom:
    base_currency: USD
    market_type: spot
    max_pairs: 10
    min_volatility: 0.002  # CRITICAL FIX: Reduced from 0.005 to enable CRO/USD
    min_volume_24h: 100000  # CRITICAL FIX: Reduced from 500000 to enable CRO/USD
    sandbox: false
    websocket_url: "wss://stream.crypto.com/v2/market"
    websocket_private: "wss://stream.crypto.com/v2/user"
invalid:
  path: test
logging:
  backup_count: 5
  file: logs/trading_bot.log
  format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
  level: INFO
  max_file_size: 10485760
mcp:
  enabled: true
  perplexity:
    api_key: ''
    base_url: https://api.perplexity.ai
    cache:
      enabled: true
      max_size: 1000
      ttl_seconds: 3600
    enabled: true
    features:
      news_analysis: true
      real_time_data: true
      web_scraping: true
      web_search: true
    max_retries: 3
    rate_limit_delay: 1.0
    scraping_settings:
      include_images: false
      include_links: true
      max_content_length: 50000
      timeout: 15
    search_settings:
      exclude_domains: []
      include_domains: []
      max_results: 10
      search_type: web
    timeout: 30
pair_selector:
  scoring_weights:
    market_cap: 0.2
    spread: 0.1
    volatility: 0.3
    volume_24h: 0.4
  selection_criteria:
    max_spread_percentage: 0.5
    max_volatility: 0.1
    min_market_cap: 100000000
    min_volatility: 0.01
    min_volume_24h: 1000000
  update_interval_minutes: 60
redis:
  db: 0
  host: localhost
  max_connections: 20
  password: ''
  port: 6379
strategies:
  engulfing_multi_tf:
    enabled: true
    parameters:
      adx_entry_threshold: 15  # CRITICAL FIX: Reduced from 22 to 15
      adx_period: 14
      atr_multiplier_sl: 1.5
      atr_multiplier_tp: 2.0
      atr_period: 14
      confirmation_timeframes: 0  # MEDIUM FIX: Removed confirmation delays
      cooldown_minutes: 60
      fixed_sl_pct: 1.2
      fixed_tp_pct: 2.5
      max_trade_duration_hours: 24
      min_bearish_engulfing: 1.2
      min_confidence: 0.18  # PROFIT FIX: Lower entry barrier
      profit_lock_percentage: 0.015    # PROFIT FIX: Lock 1.5% profit when reached
      trailing_stop_trigger: 0.02      # PROFIT FIX: Start trailing at 2%
      max_trade_duration_hours: 18     # PROFIT FIX: Reduced from 24h to avoid overnight risk
      min_engulfing_size_multiplier: 0.6
      regime_aware: true
      require_adx_and_volume_confirmation: true
      sma_period: 50
      stop_loss_pct: 1.0
      strict_volume_adx: false
      take_profit_pct: 2.0
      target_timeframes:
      - 4h
      - 1h
      - 15m
      - 5m
      timeframe_weights:
        15m: 0.2
        1h: 0.3
        4h: 0.4
        5m: 0.1
      use_atr_for_exits: true
      use_atr_levels: true
      use_volume_confirmation: true
      volume_avg_period: 10
  heikin_ashi:
    enabled: true
    parameters:
      adx_period: 14
      adx_threshold: 30  # OPTIMIZED: Higher threshold for stronger trend confirmation (reduces false signals)
      atr_period: 14
      atr_threshold: 0.0005  # OPTIMIZED: Higher volatility requirement for better setups (5x increase)
      ema_fast_period: 12
      ema_slow_period: 26
      max_hold_time_hours: 24  # OPTIMIZED: Shorter hold time to capture profits before reversal
      min_candle_size: 0.002  # OPTIMIZED: Larger candles for stronger signals (2x increase)
      min_candles: 50
      min_trend_strength: 0.0015  # OPTIMIZED: Higher trend strength requirement (2x increase)
      min_volume: 500  # OPTIMIZED: Higher volume requirement for quality trades (5x increase)
      primary_timeframe: 1h
      require_ema_confluence: true  # OPTIMIZED: Enable confluence for higher accuracy
      risk_per_trade: 0.01
      rsi_buy_threshold: 45  # OPTIMIZED: Earlier entry threshold
      rsi_confluence_threshold: 35  # OPTIMIZED: Slightly higher for quality
      rsi_overbought: 75  # OPTIMIZED: More conservative overbought (avoid tops)
      rsi_oversold: 25   # OPTIMIZED: More conservative oversold (avoid false bottoms)
      rsi_period: 14
      rsi_uptrend_max: 70  # OPTIMIZED: Lower max to avoid overbought entries
      rsi_uptrend_min: 35  # OPTIMIZED: Higher min for quality trend entries
      trend_period: 14
      volume_sma_period: 20
      volume_spike_multiplier: 1.5  # OPTIMIZED: Higher spike requirement for conviction (50% increase)
      volume_quality_filter: true  # OPTIMIZED: Enable quality filter for better entries
      volume_threshold: 1.3  # OPTIMIZED: Higher volume requirement (130% vs 80%)
      volume_threshold_percentage: 0.4  # OPTIMIZED: Higher percentile requirement (40% vs 20%)
    target_timeframes:
    - 1h
    - 15m
  multi_timeframe_confluence:
    enabled: true
    parameters:
      adx_threshold: 15  # Sideways market threshold - markets below this are sideways
      trending_adx_threshold: 25  # Strong trending market threshold - above this allows trend trades
      bb_period: 20
      bb_std: 2
      confluence_threshold: 0.6      # PROFIT FIX: Slightly lower confluence with better exits
      smart_exit_enabled: true        # PROFIT FIX: Enable intelligent exit logic
      long_period: 30
      max_price_range_pct: 35.0     # PROFIT FIX: Allow wider ranges with better stops
      entry_confirmation_required: false # PROFIT FIX: Remove confirmation delays
      max_volume_ratio: 2.0
      medium_period: 15
      min_confluence: 1  # CRITICAL FIX: Reduced to 1 for more trade opportunities
      required_timeframe_agreement: 2  # CRITICAL FIX: Reduced from 3 to 2
      min_confidence: 0.20  # PROFIT FIX: Lower barrier but add confluence requirements
      profit_protection_enabled: true   # PROFIT FIX: Enable profit locking
      dynamic_stop_loss: true          # PROFIT FIX: Trailing stops
      min_sideways_periods: 5  # Reduced for faster detection
      rsi_overbought: 70  # More sensitive levels
      rsi_oversold: 30   # More sensitive levels  
      short_period: 5
      stop_loss_pct: 0.0075
      take_profit_pct: 0.05
      vwap_period: 20
      # NEW: Support both sideways and trending markets
      enable_trending_trades: true  # Allow trades in trending markets with ADX > 25
    target_timeframes:
    - 1h
    - 15m
  strategy_pnl_enhanced:
    enabled: true
    parameters:
      atr_period: 14
      dynamic_stop_loss: true
      volatility_multiplier: 1.2
    target_timeframes:
    - 1h
    - 15m
  vwma_hull:
    enabled: true
    parameters:
      atr_period: 7
      atr_threshold: 0.0002  # OPTIMIZED: Higher ATR requirement for better volatility (4x increase)
      crossover_confidence_boost: 0.9  # OPTIMIZED: Higher confidence boost for crossovers
      hull_period: 14  # OPTIMIZED: Longer period for smoother Hull MA (reduces noise)
      min_absolute_volume: 300  # OPTIMIZED: Higher minimum volume for quality trades (6x increase)
      min_price_move: 0.0003  # OPTIMIZED: Higher minimum price move requirement (3x increase)
      min_volatility_threshold: 0.001  # OPTIMIZED: Higher volatility threshold for better entries (2x)
      scalping_enabled: false  # OPTIMIZED: Disable scalping for trend following approach
      strength_multiplier: 15  # OPTIMIZED: Higher multiplier for stronger signals
      trend_confidence_boost: 0.8  # OPTIMIZED: Higher trend confidence requirement
      trend_threshold: 0.002  # OPTIMIZED: Higher trend threshold for stronger trends (2x increase)
      volatility_adjustment: true
      volume_method: percentile
      volume_percentile: 0.3  # OPTIMIZED: Use 30th percentile for better volume filtering (3x increase)
      volume_threshold: 0.4  # OPTIMIZED: Higher volume threshold (40% vs 10%, 4x increase)
      profit_target_multiplier: 2.2  # OPTIMIZED: Higher risk-reward ratio (2.2:1 minimum)
      volume_window: 50
      vwma_period: 20
    target_timeframes:
    - 1h
    - 15m
  fibonacci:
    enabled: true
    parameters:
      min_candles: 25
      swing_lookback: 20
      fib_tolerance: 0.005  # 0.5% tolerance for Fibonacci levels
      trend_detection_period: 10
      trend_slope_threshold: 0.001
      exit_candles_required: 3
      atr_period: 14
      atr_multiplier_sl: 1.5
      atr_multiplier_tp: 2.0
      max_hold_time_hours: 24
      risk_per_trade: 0.01
      min_volume_threshold: 1.2
      volume_lookback: 10
    target_timeframes:
    - 1h
    - 15m
strategy_manager:
  analysis_timeout: 30
  max_concurrent_analyses: 10
  signal_cache_duration: 300
trading:
  max_concurrent_trades: 8      # PROFIT FIX: More concurrent trades with smaller sizes
  max_daily_loss: 0.03          # PROFIT FIX: Tighter daily loss limit
  max_daily_trades: 15           # PROFIT FIX: More trades with better R:R
  win_rate_threshold: 0.45       # PROFIT FIX: Track win rate, pause if below 45%
  consecutive_loss_limit: 4      # PROFIT FIX: Stop after 4 consecutive losses
  max_total_loss: 0.15
  max_trades_per_exchange: 100  # Increased to accommodate CryptoCom's diverse portfolio
  min_exchange_balance: 50.0
  min_order_size_usd:
    cryptocom: 12.0    # Crypto.com minimum ~$12 USD
    binance: 5.0       # Binance minimum ~$5 USD notional
    bybit: 1.0         # Bybit minimum ~$1 USD notional
    default: 15.0      # Default fallback for other exchanges
  risk_reward_minimum: 2.0  # PROFIT FIX: Minimum 2:1 risk-reward ratio
  mode: live
  position_size_percentage: 0.15  # PROFIT OPTIMIZATION: 15% position size for $100+ orders
  profit_protection:
    enabled: true
    lock_percentage: 0.025     # OPTIMIZED: Lock 2.5% profit when hit (higher lock)
    trigger_percentage: 0.04   # OPTIMIZED: Trigger at 4% profit (later trigger for bigger gains)
    partial_exit_percentage: 50 # OPTIMIZED: Take 50% profit at first target
  stop_loss_percentage: 0.055  # OPTIMIZED: Wider stop loss (5.5%) for crypto volatility - reduces false exits
  take_profit_percentage: 0.11   # OPTIMIZED: Higher take profit (11%) for better risk/reward ratio 2:1
  trailing_stop:
    enabled: true
    step_percentage: 0.005     # OPTIMIZED: Larger steps (0.5%) to avoid noise
    trigger_percentage: 0.035  # OPTIMIZED: Start trailing at 3.5% profit (later trigger)
    max_trail_distance: 0.025  # OPTIMIZED: Larger maximum trail distance (2.5%)
  fee_optimization:
    use_limit_orders: true           # Use limit orders to get maker fees (0.1% vs 0.4%)
    max_taker_fee: 0.0015           # Maximum 0.15% taker fee (alert if higher)
    prefer_maker_orders: true       # Prefer maker orders when possible
    limit_order_spread: 0.0002      # 0.02% spread for limit orders (reduced from 0.05%)
    fee_alert_threshold: 0.002      # Alert if fee rate > 0.2%
    fee_to_pnl_ratio_limit: 0.25    # Alert if fees > 25% of PnL
    order_timeout_seconds: 300      # 5 minutes timeout for limit orders
    max_retry_attempts: 2           # Maximum retry attempts for failed orders
    min_spread_for_limit: 0.0001    # Minimum spread to attempt limit order (0.01% - reduced from 0.03%)
    volatility_threshold: 0.015     # Maximum volatility for limit orders (1.5% - increased from 0.5%)
  
  # Enhanced Order Management Configuration
  order_management:
    limit_order_timeout_seconds: 300    # 5 minutes timeout for unfilled limit orders
    order_sync_interval_seconds: 30     # How often to sync order status from exchanges  
    max_cancellation_retries: 3         # Maximum attempts to cancel an order
    cancellation_retry_delay: 5         # Seconds between cancellation attempts
    competitive_pricing_enabled: true   # Use orderbook-based competitive pricing
    competitive_pricing_buffer: 0.0001  # 0.01% buffer for competitive pricing
    stale_order_cleanup_hours: 24       # Clean up old orders after 24 hours
    order_status_cache_seconds: 60      # Cache order status for 60 seconds
    
    # Performance tracking
    performance_calculation_interval: 300  # Calculate metrics every 5 minutes
    performance_history_days: 30           # Keep performance history for 30 days
    alert_on_low_success_rate: true        # Alert when success rate drops
    low_success_rate_threshold: 0.20       # Alert if success rate < 20%
    alert_on_high_timeout_rate: true       # Alert when timeout rate is high
    high_timeout_rate_threshold: 0.60      # Alert if timeout rate > 60%
trading_manager:
  cycle_interval_seconds: 60
  exit_cycle_first: true
  max_cycle_duration: 300
web_ui:
  debug: false
  host: 0.0.0.0
  port: 8000
  refresh_interval_seconds: 5

# Real-time pricing and WebSocket preferences
realtime:
  enable_websocket_prices: false
  stale_price_threshold_seconds: 30
  rest_poll_interval_seconds: 1
  ws:
    reconnect_backoff_seconds: [1, 2, 5, 10, 30]
    heartbeat_interval_seconds: 20
    max_concurrent_subscriptions_per_exchange: 50
    subscribe_only_for_open_trades: true
    exchanges:
      binance:
        enable: true
      bybit:
        enable: true
      cryptocom:
        enable: true
